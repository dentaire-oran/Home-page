<!DOCTYPE html>
<html lang="fr" data-theme="dark" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#6366f1"/>
  <title>Calcul Moyenne - 3√®me Ann√©e</title>

  <link rel="manifest" href="manifest.json"/>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web@2.1.2"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* --- 1. VARIABLES ET TH√àMES --- */
    :root { --transition-speed: 0.5s; }

    /* TH√àME SOMBRE */
    [data-theme="dark"] {
        --bg-gradient: linear-gradient(135deg, #312e81 0%, #1e1b4b 50%, #4c0519 100%);
        --glass-bg: rgba(255, 255, 255, 0.08);
        --glass-border: rgba(255, 255, 255, 0.15);
        --text-main: #ffffff;
        --text-muted: rgba(255, 255, 255, 0.7);
        --btn-hover: rgba(255, 255, 255, 0.15);
        --pill-bg: rgba(0, 0, 0, 0.3);
        --pill-color: #ffffff;
        --sidebar-bg: rgba(0, 0, 0, 0.8);
        --input-bg: rgba(0, 0, 0, 0.3);
        --success: #2ad4a5; --danger: #ff647c; --warning: #ffc94a;
    }

    /* TH√àME CLAIR */
    [data-theme="light"] {
        --bg-gradient: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 50%, #fce7f3 100%);
        --glass-bg: rgba(255, 255, 255, 0.65);
        --glass-border: rgba(255, 255, 255, 0.8);
        --text-main: #312e81;
        --text-muted: #6366f1;
        --btn-hover: rgba(255, 255, 255, 0.9);
        --pill-bg: rgba(255, 255, 255, 0.5);
        --pill-color: #312e81;
        --sidebar-bg: rgba(255, 255, 255, 0.9);
        --input-bg: rgba(255, 255, 255, 0.5);
        --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
    }

    body {
        background: var(--bg-gradient);
        color: var(--text-main);
        font-family: 'Inter', sans-serif;
        overflow-x: hidden;
        transition: background 0.5s ease, color 0.5s ease;
    }

    /* --- UTILITAIRES --- */
    .glass {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        transition: all 0.3s ease;
    }

    .text-gradient {
        background-clip: text; -webkit-background-clip: text; color: transparent;
        background-image: linear-gradient(to right, #818cf8, #c084fc, #f472b6);
    }
    [data-theme="light"] .text-gradient {
        background-image: linear-gradient(to right, #4f46e5, #9333ea, #db2777);
    }

    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    .animate-float { animation: float 6s ease-in-out infinite; }

    /* --- UI ELEMENTS --- */
    .lang-container {
        position: relative; display: flex; background: var(--pill-bg);
        border-radius: 99px; padding: 4px; border: 1px solid var(--glass-border);
        height: 48px; width: 100%; direction: ltr;
    }
    .lang-pill {
        position: absolute; top: 4px; bottom: 4px; left: 4px;
        width: calc(33.33% - 5px); background: var(--pill-color);
        border-radius: 99px; transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        z-index: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .lang-btn {
        flex: 1; position: relative; z-index: 1; font-size: 0.9rem; font-weight: 600;
        color: var(--text-muted); transition: color 0.3s;
    }
    [data-theme="dark"] .lang-btn.active { color: #333; font-weight: 800; }
    [data-theme="light"] .lang-btn.active { color: #fff; font-weight: 800; }

    .theme-toggle-btn {
        width: 48px; height: 48px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; position: relative; overflow: hidden;
        color: var(--text-main);
        flex-shrink: 0;
    }
    .theme-toggle-btn:hover { background: var(--btn-hover); }
    .theme-toggle-btn i { position: absolute; top: 50%; left: 50%; transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1); }
    
    /* Gestion ic√¥nes th√®me */
    [data-theme="dark"] .ph-moon { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
    [data-theme="dark"] .ph-sun { transform: translate(-50%, -50%) scale(0.5) rotate(90deg); opacity: 0; }
    
    [data-theme="light"] .ph-sun { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
    [data-theme="light"] .ph-moon { transform: translate(-50%, -50%) scale(0.5) rotate(-90deg); opacity: 0; }

    /* CALCULATOR STYLES */
    .module-card {
        margin-bottom: 1.5rem; padding: 1.5rem; border-radius: 1.5rem; text-align: left;
    }
    .calc-input {
        width: 100%; background: var(--input-bg); border: 1px solid var(--glass-border);
        color: var(--text-main); border-radius: 0.5rem; padding: 0.5rem 0.75rem;
        outline: none; transition: border-color 0.3s;
    }
    .calc-input:focus { border-color: #818cf8; }
    
    .anim-container { overflow: hidden; transition: max-height 0.4s ease-out, opacity 0.3s ease-out; max-height: 500px; opacity: 1; }
    .anim-container.is-hidden { max-height: 0 !important; opacity: 0; pointer-events: none; margin: 0; }

    /* RTL Sidebar Logic */
    body.switching-lang #sidebar { transition: none !important; }
    html[dir="rtl"] #sidebar { right: 0; left: auto; transform: translateX(100%); border-left: 1px solid var(--glass-border); border-right: none; }
    html[dir="ltr"] #sidebar { left: 0; right: auto; transform: translateX(-100%); border-right: 1px solid var(--glass-border); border-left: none; }
    #sidebar.open { transform: translateX(0) !important; }
    html[dir="rtl"] #menuBtn { right: 2rem; left: auto; }
    html[dir="ltr"] #menuBtn { left: 2rem; right: auto; }

    /* Boutons d'Action */
    .btn-action {
        padding: 0.75rem 1.5rem; border-radius: 9999px; font-weight: 600;
        transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; cursor: pointer;
    }
    .btn-primary {
        color: var(--text-main);
        background: linear-gradient(135deg, rgba(129, 140, 248, 0.3), rgba(192, 132, 252, 0.3));
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .btn-primary:hover { transform: translateY(-2px) scale(1.05); box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2); }
    .btn-primary:active { transform: scale(0.98); box-shadow: none; }
  </style>
</head>

<body>

  <div id="sidebar" class="fixed inset-y-0 z-50 w-80 glass transition-transform duration-500 ease-out flex flex-col" style="background: var(--sidebar-bg);">
    <div class="p-8 pt-24 flex flex-col h-full overflow-y-auto">
      <h2 class="text-3xl font-bold text-gradient mb-10" data-key="appTitle">Dental Guide</h2>

      <div class="flex items-center gap-3 mb-10">
        <div class="lang-container">
            <div class="lang-pill" id="langPill"></div>
            <button data-lang="fr" class="lang-btn active">FR</button>
            <button data-lang="en" class="lang-btn">EN</button>
            <button data-lang="ar" class="lang-btn">AR</button>
        </div>
        <div class="theme-toggle-btn glass" id="themeBtn">
            <i class="ph-fill ph-moon text-xl"></i>
            <i class="ph-fill ph-sun text-xl"></i>
        </div>
      </div>

      <div class="space-y-4">
        <a href="#" class="w-full py-4 px-6 rounded-2xl glass hover:bg-white/20 transition flex items-center gap-3 text-lg font-medium" style="color: var(--text-main);">
           <i class="ph-bold ph-house text-xl"></i> <span data-key="home">Accueil</span>
        </a>
        
        <a href="#" class="w-full py-4 px-6 rounded-2xl glass transition flex items-center gap-3 text-lg font-medium" style="color: var(--text-main); background: rgba(129, 140, 248, 0.2);">
           <i class="ph-bold ph-graduation-cap text-xl text-indigo-400"></i> <span data-key="year3">3√®me Ann√©e</span>
        </a>

        <div class="w-full h-px bg-white/20 my-2"></div>

        <a href="mailto:dentaireoranmoy@gmail.com" class="w-full py-4 px-6 rounded-2xl glass hover:bg-white/20 transition flex items-center gap-3 text-lg font-medium" style="color: var(--text-main);">
          <i class="ph-bold ph-envelope text-xl"></i> <span data-key="contact">Nous contacter</span>
        </a>
      </div>
    </div>
  </div>

  <div id="overlay" class="fixed inset-0 bg-black/40 z-40 hidden backdrop-blur-sm transition-opacity" onclick="closeMenu()"></div>
  
  <button id="menuBtn" class="fixed top-8 z-50 p-3 rounded-2xl glass hover:bg-white/20 transition active:scale-95 shadow-lg" style="color: var(--text-main);">
    <i class="ph-bold ph-list text-3xl"></i>
  </button>

  <main class="pt-28 pb-32 px-4 sm:px-6 max-w-4xl mx-auto text-center">
    <h1 class="text-4xl md:text-6xl font-bold text-gradient animate-float mb-4" data-key="pageTitle">Calcul de Moyenne</h1>
    <p class="text-xl mb-10 font-light" style="color: var(--text-muted);" data-key="subtitle">Simulateur pour la 3√®me ann√©e</p>

    <div class="glass p-4 rounded-xl mb-8 text-sm flex items-start gap-3 text-left" style="color: var(--text-main);">
        <i class="ph-fill ph-info text-2xl text-blue-400 mt-0.5 flex-shrink-0"></i>
        <p data-key="infoText">Saisissez seulement les notes qui vous concernent. Les champs vides sont ignor√©s lors du calcul.</p>
    </div>

    <form id="form" class="space-y-6"></form>

    <div id="calc-actions" class="mt-10 flex flex-wrap justify-center gap-4">
        <button type="button" onclick="calculer()" class="btn-action btn-primary bg-indigo-500/50 hover:bg-indigo-600/70">
            <i class="ph-bold ph-calculator"></i> <span data-key="btnCalc">Calculer</span>
        </button>
        <button type="button" onclick="saveResults()" class="btn-action btn-primary">
            <i class="ph-bold ph-floppy-disk"></i> <span data-key="btnSave">Enregistrer</span>
        </button>
        <button type="button" onclick="loadResults()" class="btn-action btn-primary">
            <i class="ph-bold ph-upload-simple"></i> <span data-key="btnLoad">Charger</span>
        </button>
    </div>

    <div id="resultat" class="mt-8 space-y-4"></div>
  </main>

  <a href="mailto:dentaireoranmoy@gmail.com" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-40 group w-max max-w-[90%]">
    <div class="px-6 py-3 rounded-full glass shadow-2xl flex items-center justify-center gap-3 font-semibold transition hover:scale-105 active:scale-95 border border-white/20 backdrop-blur-xl whitespace-nowrap" style="color: var(--text-main); background: rgba(0,0,0,0.5);">
      <i class="ph-fill ph-paper-plane-right text-lg group-hover:-rotate-12 transition-transform"></i>
      <span data-key="contact">Nous contacter</span>
    </div>
  </a>
  
  <script>
    // === 1. CONFIGURATION ===
    const html = document.documentElement; // R√©f√©rence globale au tag HTML

    const modules = [ 
        { nom: "Oc", display: "Occlusion", coef: 5, icon: "tooth", e1: true, e2: true, td: true, tp: true }, 
        { nom: "Odf", display: "ODF", coef: 5, icon: "align-center-horizontal-simple", e1: true, e2: true, td: true, tp: true },
        { nom: "Paro", display: "Parodontologie", coef: 5, icon: "microscope", e1: true, e2: true, td: true, tp: true },
        { nom: "Patho", display: "Pathologie", coef: 5, icon: "first-aid-kit", e1: true, e2: true, td: true, tp: true },
        { nom: "Prothese", display: "Proth√®se", coef: 5, icon: "cube", e1: true, e2: true, td: true, tp: true }, 
        { nom: "Imagrie medical", display: "Imagerie M√©dicale", coef: 3, icon: "x-ray", e1: true, e2: true, td: true, tp: true },
        { nom: "Anatomi pathologique", display: "Anatomie Pathologique", coef: 1, icon: "brain", e1: true, e2: true, td: true, tp: true }, 
        { nom: "Anesthesiologie", display: "Anesth√©siologie", coef: 1, icon: "syringe", e1: true, e2: true, td: true, tp: true },
        { nom: "Pharmacologie", display: "Pharmacologie", coef: 1, icon: "pills", e1: true, e2: true, td: true, tp: true },
        { nom: "Occlusodontie", display: "Occlusodontie", coef: 1, icon: "tooth", e1: true, e2: true, td: true, tp: true },
        { nom: "Oxyologie", display: "Oxyologie", coef: 1, icon: "lungs", e1: true, e2: true, td: true, tp: true }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        initForm();
        // Initialiser l'√©tat des checkbox pour s'assurer de la coh√©rence visuelle
        modules.forEach((_, i) => toggleManualMoyenne(i, false)); 
        initTheme(); // Initialiser le th√®me
        initLang(localStorage.getItem('lang') || 'fr'); // Initialiser la langue
    });

    // === 2. G√âN√âRATION DU FORMULAIRE ===
    function initForm() {
        const form = document.getElementById("form");
        form.innerHTML = ""; // Clean start
        modules.forEach((mod, i) => {
            const card = document.createElement("div");
            card.className = "glass module-card"; 
            
            card.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold flex items-center gap-2" style="color: var(--text-main);">
                        <i class="ph-duotone ph-${mod.icon} text-2xl text-indigo-400"></i> ${mod.display}
                        <span class="text-xs bg-white/10 px-2 py-1 rounded text-white/70 border border-white/10">Coef ${mod.coef}</span>
                    </h3>
                    <label class="flex items-center gap-2 text-sm cursor-pointer text-white/70 hover:text-white transition">
                        <input type="checkbox" id="${i}_manual_cb" onchange="toggleManualMoyenne(${i})" class="accent-indigo-500 w-4 h-4"> 
                        <span data-key="manualMode">Entrer moyenne</span>
                    </label>
                </div>

                <div id="${i}_manual_container" class="anim-container is-hidden mb-2">
                    <input type="number" step="0.01" min="0" max="20" id="${i}_manual_moyenne" 
                           class="calc-input" placeholder="Moyenne (ex: 12.5)" oninput="updateModuleDisplay(${i})">
                </div>

                <div id="${i}_notes_fields" class="grid grid-cols-2 gap-4 anim-container">
                    ${mod.e1 ? `<div><label class="block text-xs mb-1 opacity-70">EMD S1</label><input type="number" step="0.01" min="0" max="20" id="${i}_emd1" class="calc-input" oninput="updateModuleDisplay(${i})"></div>` : ""}
                    ${mod.e2 ? `<div><label class="block text-xs mb-1 opacity-70">EMD S2</label><input type="number" step="0.01" min="0" max="20" id="${i}_emd2" class="calc-input" oninput="updateModuleDisplay(${i})"></div>` : ""}
                    ${mod.td ? `<div><label class="block text-xs mb-1 opacity-70">TD</label><input type="number" step="0.01" min="0" max="20" id="${i}_td" class="calc-input" oninput="updateModuleDisplay(${i})"></div>` : ""}
                    ${mod.tp ? `<div><label class="block text-xs mb-1 opacity-70">TP</label><input type="number" step="0.01" min="0" max="20" id="${i}_tp" class="calc-input" oninput="updateModuleDisplay(${i})"></div>` : ""}
                </div>

                <div class="mt-4 pt-4 border-t border-white/10 flex justify-end">
                    <div class="font-bold text-lg transition-colors duration-300" id="${i}_moyenne_module">-</div>
                </div>
            `;
            form.appendChild(card);
        });
    }

    function toggleManualMoyenne(index, animate = true) {
        const isChecked = document.getElementById(`${index}_manual_cb`).checked;
        const manualContainer = document.getElementById(`${index}_manual_container`);
        const notesFields = document.getElementById(`${index}_notes_fields`);
        
        if (isChecked) {
            manualContainer.classList.remove('is-hidden');
            notesFields.classList.add('is-hidden');
        } else {
            notesFields.classList.remove('is-hidden');
            manualContainer.classList.add('is-hidden');
        }
        if(animate) updateModuleDisplay(index);
    }

    // === 3. LOGIQUE DE CALCUL ===
    function getVal(id) {
        const el = document.getElementById(id);
        if (!el || el.value === "") return NaN;
        return parseFloat(el.value.replace(',', '.'));
    }

    function getModuleMoyenne(i) {
        let moyMod = 0, filled = false;
        const isManual = document.getElementById(`${i}_manual_cb`).checked;

        if (isManual) {
            const val = getVal(`${i}_manual_moyenne`);
            if (!isNaN(val)) { moyMod = val; filled = true; }
        } else {
            let pts = 0, coefsCalc = 0;
            const e1 = getVal(`${i}_emd1`);
            const e2 = getVal(`${i}_emd2`);
            const td = getVal(`${i}_td`);
            const tp = getVal(`${i}_tp`);
            
            // V√©rifier si au moins une note est entr√©e
            if ([e1, e2, td, tp].some(v => !isNaN(v))) filled = true;
            
            // Logique sp√©cifique (adaptable selon le r√®glement des √©tudes)
            let emdSum = 0, emdCount = 0;
            if (!isNaN(e1)) { emdSum += e1; emdCount++; }
            if (!isNaN(e2)) { emdSum += e2; emdCount++; }
            
            if (emdCount > 0) { pts += (emdSum / emdCount); coefsCalc++; } // Moyenne des EMDs compte pour 1 part
            if (!isNaN(td)) { pts += td; coefsCalc++; }
            if (!isNaN(tp)) { pts += tp * 2; coefsCalc += 2; } // TP compte double (selon votre logique initiale)
            
            if (coefsCalc > 0 && filled) moyMod = pts / coefsCalc;
        }
        return { moyenne: moyMod, filled: filled };
    }

    function updateModuleDisplay(i) {
        const { moyenne, filled } = getModuleMoyenne(i);
        const moyElem = document.getElementById(`${i}_moyenne_module`);
        if (filled) {
            moyElem.textContent = `${moyenne.toFixed(2)}`;
            if (moyenne < 5) moyElem.style.color = 'var(--danger)';
            else if (moyenne < 10) moyElem.style.color = 'var(--warning)';
            else moyElem.style.color = 'var(--success)';
        } else {
            moyElem.textContent = '-';
            moyElem.style.color = 'var(--text-main)';
        }
    }

    function calculer() {
        let totalPoints = 0, totalCoefs = 0, under5 = [], under10 = [];
        let hasAnyData = false;

        modules.forEach((mod, i) => {
            const { moyenne, filled } = getModuleMoyenne(i);
            // Forcer l'affichage √† jour
            updateModuleDisplay(i); 

            if(filled){
                hasAnyData = true;
                if(moyenne < 5) under5.push(mod.display);
                else if(moyenne < 10) under10.push(mod.display);
                totalPoints += moyenne * mod.coef;
                totalCoefs += mod.coef;
            }
        });

        const resDiv = document.getElementById("resultat");
        
        if (!hasAnyData || totalCoefs === 0) {
            resDiv.innerHTML = `<div class="glass p-4 border-l-4 border-yellow-500 text-yellow-200 text-left">Veuillez entrer au moins une note.</div>`;
            return;
        }
        
        const moyGen = (totalPoints / totalCoefs).toFixed(2);
        let htmlResult = `
            <div class="glass p-6 rounded-2xl animate-float border-t-4 ${moyGen >= 10 ? 'border-green-400' : 'border-red-400'}">
                <p class="text-lg opacity-80">Moyenne G√©n√©rale</p>
                <h2 class="text-6xl font-bold my-4 text-gradient">${moyGen}</h2>
        `;

        if(moyGen >= 10 && under5.length === 0){
            htmlResult += `<div class="inline-block px-4 py-2 bg-green-500/20 text-green-300 rounded-full font-bold border border-green-500/30">üéâ Ann√©e valid√©e !</div>`;
        } else {
            if(moyGen < 10) htmlResult += `<div class="mb-3 inline-block px-4 py-2 bg-red-500/20 text-red-300 rounded-full font-bold border border-red-500/30">Moyenne insuffisante</div>`;
            
            htmlResult += `<div class="mt-4 space-y-2 text-left bg-black/20 p-4 rounded-lg">`;
            if(under5.length > 0) htmlResult += `<div class="text-sm text-red-300 flex items-start gap-2"><i class="ph-bold ph-warning-circle mt-1"></i> <span><strong>Note √©liminatoire (< 5) :</strong> ${under5.join(', ')}</span></div>`;
            if(under10.length > 0) htmlResult += `<div class="text-sm text-yellow-300 flex items-start gap-2"><i class="ph-bold ph-info mt-1"></i> <span><strong>√Ä compenser :</strong> ${under10.join(', ')}</span></div>`;
            htmlResult += `</div>`;
        }
        htmlResult += `</div>`;
        resDiv.innerHTML = htmlResult;
        resDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // === 4. SAUVEGARDE ET CHARGEMENT ===
    function saveResults() {
        const data = modules.map((_, i) => {
            return {
                manual: document.getElementById(`${i}_manual_cb`).checked,
                manualVal: document.getElementById(`${i}_manual_moyenne`).value,
                emd1: document.getElementById(`${i}_emd1`)?.value,
                emd2: document.getElementById(`${i}_emd2`)?.value,
                td: document.getElementById(`${i}_td`)?.value,
                tp: document.getElementById(`${i}_tp`)?.value
            };
        });
        localStorage.setItem('saved_notes', JSON.stringify(data));
        const lang = localStorage.getItem('lang') || 'fr';
        showToast(translations[lang].saved || "Donn√©es enregistr√©es !");
    }

    function loadResults() {
        const saved = localStorage.getItem('saved_notes');
        const lang = localStorage.getItem('lang') || 'fr';
        
        if (!saved) {
            showToast(translations[lang].noData || "Aucune donn√©e trouv√©e.");
            return;
        }

        try {
            const data = JSON.parse(saved);
            data.forEach((item, i) => {
                if(i >= modules.length) return;
                
                // Restaurer Checkbox
                const cb = document.getElementById(`${i}_manual_cb`);
                cb.checked = item.manual;
                toggleManualMoyenne(i, false); // Mettre √† jour l'UI sans anim excessive

                // Restaurer Valeurs
                if (document.getElementById(`${i}_manual_moyenne`)) document.getElementById(`${i}_manual_moyenne`).value = item.manualVal;
                if (document.getElementById(`${i}_emd1`)) document.getElementById(`${i}_emd1`).value = item.emd1;
                if (document.getElementById(`${i}_emd2`)) document.getElementById(`${i}_emd2`).value = item.emd2;
                if (document.getElementById(`${i}_td`)) document.getElementById(`${i}_td`).value = item.td;
                if (document.getElementById(`${i}_tp`)) document.getElementById(`${i}_tp`).value = item.tp;
                
                updateModuleDisplay(i);
            });
            calculer(); // Lancer le calcul automatiquement
            showToast(translations[lang].loaded || "Donn√©es charg√©es !");
        } catch (e) {
            console.error(e);
            showToast("Erreur lors du chargement.");
        }
    }

    // === 5. INTERNATIONALISATION ===
    const translations = {
      fr: { appTitle: "Dental Guide", pageTitle: "Calcul de Moyenne", subtitle: "Simulateur pour la 3√®me ann√©e", infoText: "Saisissez seulement les notes qui vous concernent. Les champs vides sont ignor√©s.", btnCalc: "Calculer", btnSave: "Enregistrer", btnLoad: "Charger", manualMode: "Entrer moyenne", home: "Accueil", year3: "3√®me Ann√©e", contact: "Nous contacter", saved: "Donn√©es sauvegard√©es avec succ√®s !", loaded: "Donn√©es charg√©es avec succ√®s !", noData: "Aucune sauvegarde trouv√©e." },
      en: { appTitle: "Dental Guide", pageTitle: "GPA Calculator", subtitle: "Simulator for 3rd Year", infoText: "Enter only relevant grades. Empty fields are ignored.", btnCalc: "Calculate", btnSave: "Save", btnLoad: "Load", manualMode: "Enter Average", home: "Home", year3: "3rd Year", contact: "Contact Us", saved: "Data saved successfully!", loaded: "Data loaded successfully!", noData: "No saved data found." },
      ar: { appTitle: "ÿØŸÑŸäŸÑ ÿ∑ÿ® ÿßŸÑÿ£ÿ≥ŸÜÿßŸÜ", pageTitle: "ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿπÿØŸÑ", subtitle: "ŸÖÿ≠ÿßŸÉŸä ŸÑŸÑÿ≥ŸÜÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©", infoText: "ÿ£ÿØÿÆŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ™Ÿä ÿ™ŸáŸÖŸÉ ŸÅŸÇÿ∑. ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ© Ÿäÿ™ŸÖ ÿ™ÿ¨ÿßŸáŸÑŸáÿß.", btnCalc: "ÿ≠ÿ≥ÿßÿ®", btnSave: "ÿ≠ŸÅÿ∏", btnLoad: "ÿ™ÿ≠ŸÖŸäŸÑ", manualMode: "ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÖÿπÿØŸÑ", home: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©", year3: "ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©", contact: "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß", saved: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!", loaded: "ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!", noData: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ŸÅŸàÿ∏ÿ©." }
    };

    const langPill = document.getElementById('langPill');
    const langBtns = document.querySelectorAll('.lang-btn');

    const updateLanguage = (lang) => {
      document.body.classList.add('switching-lang');
      const index = lang === 'fr' ? 0 : lang === 'en' ? 1 : 2;
      langPill.style.transform = `translateX(${index * 100}%)`;
      
      langBtns.forEach(btn => {
        if (btn.dataset.lang === lang) btn.classList.add('active');
        else btn.classList.remove('active');
      });

      setTimeout(() => {
          const isRTL = lang === 'ar';
          html.setAttribute('lang', lang);
          html.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
          localStorage.setItem('lang', lang);

          // Traduction dynamique
          document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.getAttribute('data-key');
            if (translations[lang][key]) el.textContent = translations[lang][key];
          });
          
          // Mise √† jour des placeholders sp√©cifiques si besoin
          requestAnimationFrame(() => { document.body.classList.remove('switching-lang'); });
      }, 300);
    };

    const initLang = (lang) => {
      const isRTL = lang === 'ar';
      html.setAttribute('lang', lang);
      html.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
      const index = lang === 'fr' ? 0 : lang === 'en' ? 1 : 2;
      langPill.style.transform = `translateX(${index * 100}%)`;
      
      langBtns.forEach(btn => {
        if (btn.dataset.lang === lang) btn.classList.add('active');
        else btn.classList.remove('active');
      });

      document.querySelectorAll('[data-key]').forEach(el => {
        const key = el.getAttribute('data-key');
        if (translations[lang] && translations[lang][key]) el.textContent = translations[lang][key];
      });
    };

    langBtns.forEach(btn => btn.addEventListener('click', () => updateLanguage(btn.dataset.lang)));

    // === 6. THEME LOGIC ===
    const themeBtn = document.getElementById('themeBtn');
    
    function initTheme() {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);
    }

    themeBtn.addEventListener('click', () => {
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
    });

    // === 7. SIDEBAR & TOAST ===
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const menuBtn = document.getElementById('menuBtn');
    
    menuBtn.onclick = (e) => { 
        e.stopPropagation(); 
        sidebar.classList.toggle('open'); 
        if(sidebar.classList.contains('open')) overlay.classList.remove('hidden'); 
        else overlay.classList.add('hidden'); 
    };
    
    window.closeMenu = () => { 
        sidebar.classList.remove('open'); 
        overlay.classList.add('hidden'); 
    };

    const showToast = (msg) => {
        const container = document.getElementById('toastContainer') || (() => {
            const div = document.createElement('div');
            div.id = 'toastContainer';
            div.className = 'fixed bottom-28 left-1/2 -translate-x-1/2 flex flex-col-reverse gap-3 z-50 pointer-events-none w-max max-w-[90%]';
            document.body.appendChild(div);
            return div;
        })();
        
        const toast = document.createElement('div');
        toast.className = 'px-6 py-3 rounded-full glass text-white shadow-2xl flex items-center gap-3 translate-y-10 opacity-0 transition-all duration-500 font-semibold text-sm sm:text-base';
        toast.style.background = "rgba(0,0,0,0.85)";
        toast.innerHTML = `<i class="ph-bold ph-check-circle text-green-400 text-xl"></i> <span>${msg}</span>`;
        
        container.appendChild(toast);
        
        requestAnimationFrame(() => toast.classList.remove('translate-y-10', 'opacity-0'));
        setTimeout(() => { 
            toast.classList.add('translate-y-10', 'opacity-0'); 
            setTimeout(() => toast.remove(), 500); 
        }, 3000);
    };
  </script>
</body>
</html>
